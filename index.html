<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bondhu Messenger - Global</title>
    <style>
        /* Essential styles for older mobile browsers */
        body { background-color: #e5ddd5; margin: 0; padding: 0; font-family: Arial, sans-serif; color: #333; }
        
        /* Top Header */
        .header { background-color: #075e54; color: #ffffff; padding: 12px; font-weight: bold; font-size: 16px; border-bottom: 1px solid #054c44; }
        .status { font-size: 10px; font-weight: normal; margin-left: 5px; color: #dcf8c6; }

        /* Login Container */
        .login-box { background: #ffffff; margin: 15px; padding: 15px; border: 1px solid #ccc; text-align: center; border-radius: 4px; }
        .input-field { width: 90%; padding: 10px; margin: 8px 0; border: 1px solid #999; font-size: 14px; }
        .start-btn { background-color: #25d366; color: white; border: none; padding: 12px; width: 95%; font-weight: bold; font-size: 15px; cursor: pointer; }

        /* Chat Interface */
        #chat_box { display: none; padding-bottom: 70px; } /* Space for the bottom bar */
        .menu-bar { background: #ffffff; padding: 8px; border-bottom: 1px solid #ddd; font-size: 12px; clear: both; overflow: hidden; }
        
        /* Message Area - Natural scrolling for Java Phones */
        #messages { padding: 10px; min-height: 300px; background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); background-repeat: repeat; }
        
        .msg-container { width: 100%; margin-bottom: 10px; clear: both; overflow: hidden; display: block; }
        .bubble { padding: 8px 12px; border-radius: 6px; border: 1px solid #bbb; display: inline-block; max-width: 80%; word-wrap: break-word; font-size: 14px; line-height: 1.4; }
        
        /* Message Alignment */
        .sent-row { text-align: right; }
        .received-row { text-align: left; }
        .sent-bubble { background-color: #dcf8c6; }
        .received-bubble { background-color: #ffffff; }

        .user-label { font-size: 10px; color: #075e54; font-weight: bold; display: block; margin-bottom: 3px; text-transform: capitalize; }

        /* Input Footer */
        .footer { background: #f0f0f0; padding: 10px; border-top: 1px solid #ccc; text-align: center; }
        .msg-input { width: 70%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
        .send-btn { width: 22%; padding: 10px; background: #075e54; color: white; border: none; font-weight: bold; border-radius: 4px; cursor: pointer; }
        
        .exit-btn { background: #ff4d4d; color: white; border: none; padding: 4px 8px; font-size: 10px; float: right; border-radius: 3px; cursor: pointer; }
    </style>
</head>
<body>

<div class="header">
    Bondhu <span class="status">â€¢ Online</span>
</div>

<div id="login_area" class="login-box">
    <b style="font-size: 18px; color: #075e54;">Bondhu Messenger</b><br><br>
    <input type="text" id="my_id" class="input-field" placeholder="Your Name-Pin"><br>
    <input type="text" id="friend_id" class="input-field" placeholder="Friend Name-Pin"><br>
    <button class="start-btn" onclick="startApp()">START CHATTING</button>
</div>

<div id="chat_box">
    <div class="menu-bar">
        History: <select id="month_select" onchange="fetchData()" style="font-size: 12px;"></select>
        <button class="exit-btn" onclick="location.reload()">Exit</button>
    </div>

    <div id="messages"></div>
    
    <div class="footer">
        <input type="text" id="msg_input" class="msg-input" placeholder="Type a message...">
        <button class="send-btn" onclick="sendMessage()">SEND</button>
    </div>
</div>

<script>
    /* Obfuscated Database Logic for Security */
    var _0xdb = "aHR0cHM6Ly9ib25kaHUtNDg5ZWEtZGVmYXVsdC1ydGRiLmZpcmViYXNlaW8uY29tL3NlY3VyZV9jaGF0cy8=";
    var _0xid = ""; var _0xun = "";

    function startApp() {
        var a = document.getElementById('my_id').value.trim();
        var b = document.getElementById('friend_id').value.trim();
        if(a == "" || b == "") { alert("Please enter both IDs"); return; }
        
        var p = [a, b].sort();
        _0xid = btoa(p[0] + p[1]).replace(/=/g, "");
        _0xun = a.split('-')[0];
        
        document.getElementById('login_area').style.display = 'none';
        document.getElementById('chat_box').style.display = 'block';
        
        setupMenu(); 
        fetchData();
        setInterval(fetchData, 10000); // 10-second refresh for compatibility
    }

    function setupMenu() {
        var m = document.getElementById('month_select');
        var d = new Date(); var s = new Date(2025, 0, 1);
        while(s <= d) {
            var mName = s.toLocaleString('en-US', { month: 'short' });
            var val = s.getFullYear() + "_" + (s.getMonth() + 1);
            var opt = document.createElement('option');
            opt.value = val; opt.innerHTML = mName + " " + s.getFullYear();
            m.insertBefore(opt, m.firstChild);
            s.setMonth(s.getMonth() + 1);
        }
    }

    function sendMessage() {
        var t = document.getElementById('msg_input').value;
        var sm = document.getElementById('month_select').value;
        if(t == "") return;
        
        var data = JSON.stringify({"u": _0xun, "m": t});
        var x = new XMLHttpRequest();
        x.open("POST", atob(_0xdb) + _0xid + "/" + sm + ".json", true);
        x.send(data);
        
        document.getElementById('msg_input').value = "";
        setTimeout(fetchData, 1500);
    }

    function fetchData() {
        if(_0xid == "") return;
        var sm = document.getElementById('month_select').value;
        var x = new XMLHttpRequest();
        x.open("GET", atob(_0xdb) + _0xid + "/" + sm + ".json", true);
        x.onreadystatechange = function() {
            if(x.readyState == 4 && x.status == 200) {
                var res = JSON.parse(x.responseText);
                var html = "";
                for(var key in res) { 
                    var isMe = (res[key].u == _0xun);
                    var rowClass = isMe ? "sent-row" : "received-row";
                    var bubClass = isMe ? "sent-bubble" : "received-bubble";
                    html += "<div class='msg-container " + rowClass + "'><div class='bubble " + bubClass + "'><span class='user-label'>" + res[key].u + "</span>" + res[key].m + "</div></div>"; 
                }
                document.getElementById('messages').innerHTML = html || "<center style='color:gray; padding:20px;'>No messages found.</center>";
            }
        };
        x.send();
    }
</script>
</body>
</html>
